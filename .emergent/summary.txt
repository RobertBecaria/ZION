<analysis>
The previous AI engineer successfully implemented a dynamic personal profile system with granular privacy controls and subsequently began developing a school employee management feature. Initially, the focus was on extending the user profile with context-specific data (family, work, public) and a comprehensive 13-item privacy settings interface, including a custom toggle switch UI. Following this, the project pivoted to integrate a School Employee Management system into the existing ORGANIZATION framework, specifically addressing teacher profiles, subjects, and grade assignments, tailored to the Russian school system. Key architectural decisions included extending existing FastAPI models and creating new React components. The engineer efficiently handled user feedback, including debugging a UI blinking issue by optimizing React re-renders, and systematically progressed through backend and frontend development, ensuring robust functionality and an interactive UI.
</analysis>

<product_requirements>
The initial request was to create a dynamic personal profile system for users. This profile should display different information based on the active module (e.g., Family or Organization) and the viewer's context (public, organization members, or self). For instance, in the Family context, it would show upcoming birthdays and addresses, while in Organization, it would display business card information, job title, department, team, and manager details, with more specifics for company members. The user later requested a detailed privacy settings list with 13 specific controls (across Family, Work, and Public contexts) and a custom toggle switch UI. Subsequently, the user requested an expansion to include School profiles within the ORGANIZATION section, specifically for teachers and directors in Phase 1, using the Russian school system structure (Primary, Basic, Secondary grades). This involves enabling teachers to register subjects and grades, and directors to manage school employees.
</product_requirements>

<key_technical_concepts>
- **FastAPI:** Python framework for backend APIs.
- **React:** JavaScript library for building user interfaces.
- **MongoDB:** NoSQL database for data storage.
- **Pydantic:** Data validation and settings management for Python models.
- **Tailwind CSS:** Utility-first CSS framework for UI styling.
- **Dynamic Routing/Visibility:** Frontend and backend logic to adapt content based on user context and permissions.
- **Component-Based UI:** Modular React components for UI elements.
</key_technical_concepts>

<code_architecture>
The application follows a full-stack architecture with a React frontend, FastAPI backend, and MongoDB database, running in a Kubernetes container environment.

**Directory Structure:**


- **/app/backend/server.py**
    - **Importance:** This is the core backend file, containing FastAPI application setup, Pydantic models for data, and all API endpoints. It defines how data is structured, validated, and accessed.
    - **Changes:**
        - **Profile Models:** Added , ,  to define the structure for user privacy preferences and profile data.
        - **Profile Endpoints:** Introduced  (GET, PUT) and  (PUT) for managing user profiles and privacy settings.
        - **School Constants:** Integrated  and  dictionaries for standardized school data.
        - **WorkOrganization Model Extension:** Added , , ,  fields to the  model for educational organizations.
        - **WorkMember Model Extension:** Added , , , ,  fields to the  model for teacher profiles.
        - **Teacher Management Models:** Created  and  for handling teacher-specific data.
        - **Teacher Endpoints:** Added  (POST, PUT, GET) and  endpoints for managing teacher profiles and fetching school-related constants.
        - **Privacy Update Logic:** Updated the  function to handle the new, comprehensive set of 13 privacy toggles.

- **/app/frontend/src/App.js**
    - **Importance:** The main entry point for the React application, responsible for global state management, routing, and rendering top-level components including the sidebar and content views.
    - **Changes:**
        - Imported , , and  components.
        - Added conditional rendering to display  when .
        - Updated CSS class logic to ensure  uses a full-width layout.
        - Modified visibility logic for the events panel to hide it when  is active.

- **/app/frontend/src/components/MyProfile.js**
    - **Importance:** A new component dedicated to displaying the user's personal profile dynamically based on context and managing privacy settings.
    - **Changes:** Created from scratch. Implemented dynamic header, tabbed sections, and integrated the  component. Updated to support the 13 new privacy controls and a specific toggle switch UI design.

- **/app/frontend/src/App.css**
    - **Importance:** Contains global CSS styles for the entire application.
    - **Changes:** Appended specific styles for the  component, including layout, typography, and the custom toggle switch design for privacy settings.

- **/app/frontend/src/components/TeacherProfileForm.js**
    - **Importance:** A new component enabling teachers to input and update their school-specific profile details such as subjects taught, grades, and class supervision.
    - **Changes:** Created from scratch to handle teacher profile data submission and updates.

- **/app/frontend/src/components/TeacherDirectory.js**
    - **Importance:** A new component designed to display a list or directory of teachers within an educational organization, along with their key details like subjects and grades.
    - **Changes:** Created from scratch. Wrapped in  to prevent unnecessary re-renders and improve performance.

- **/app/frontend/src/components/WorkOrganizationProfile.js**
    - **Importance:** Displays details for a work organization, including its members. It now integrates school-specific features for educational organizations.
    - **Changes:**
        - Imported  and .
        - Added state variables (, ).
        - Added a new УЧИТЕЛЯ (Teachers) tab, visible only for  organizations.
        - Integrated the  within the new УЧИТЕЛЯ tab and the  as a modal.
        - Corrected the logic to properly set  upon loading organization data.
        - Introduced a floating action button for easier access to the teacher profile form.
        - Fixed a performance issue by removing  from the  dependency array, which was causing rapid re-renders and a blinking UI.
</code_architecture>

<pending_tasks>
- Full implementation of student and parent profiles.
- Development of class schedules functionality for students and teachers.
- Creation of student journal/gradebook features (view grades, homework submission).
- Parent-specific features, including multi-child views and communication tools.
- Academic calendar integration.
- School discovery and enrollment mechanisms for students.
</pending_tasks>

<current_work>
The AI engineer has just completed implementing Phase 1 of the School Employee Management System. This involved significant updates to both the backend and frontend. On the backend,  was extended with new models for school organizations and teacher profiles, incorporating Russian school constants and fields for subjects and grades. New API endpoints were created for managing teacher data and fetching school constants. On the frontend,  and  components were created and integrated into . A new УЧИТЕЛЯ (Teachers) tab is now visible in educational organization profiles, displaying the teacher directory and allowing teachers to edit their information via a modal form, accessible through a floating action button.

Immediately prior to this summary request, the user reported a blinking issue on the TEACHERS tab. The AI engineer successfully diagnosed and fixed this by identifying a problematic  dependency () in  causing excessive re-renders. Additionally,  was wrapped with  to further optimize performance. Console logs added for debugging were also removed. The services are running without reported errors.
</current_work>

<optional_next_step>
Test the updated teacher profile editing functionality and school employee directory in the frontend to ensure all new fields are manageable and displayed correctly.
</optional_next_step>
